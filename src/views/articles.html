<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="app-articles">

  <template>

    <style include="iron-flex iron-flex-alignment">
      :host {
        display: block;
        padding: 0;
      }
      .card {
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        padding: 16px;
        margin: 24px;
        border-radius: 5px;
        background-color: #fff;
        color: #757575;
      }

      .title {
        @apply(--paper-font-title);
        padding-bottom: 20px;
      }
      .item .article {
        width: 90%;
        @apply(--paper-font-body2);
      }
      .item[wide-layout] .article {
        max-width: 840px;
      }
      @media only screen and (max-width: 900px) {
        .article {
          width: 100%;
        }
      }

    </style>

    <app-route
        route="{{subRoute}}"
        pattern="/:id"
        data="{{articleData}}">
    </app-route>

    <iron-ajax id="articleFeed"
           url="https://account.acquisio.com/services/api/v1/articles/{{articleId}}"
           method="GET"
           auto
           last-response="{{article}}"
           loading="{{articleLoading}}"
           on-response="_onArticleResult"></iron-ajax>
    
    <iron-media-query query="(min-width: 900px)" query-matches="{{wide}}"></iron-media-query>

    <div class="card layout vertical item" wide-layout$="{{wide}}">

        <div class="title self-center">@Model.Title {{articleId}}</div>
        <marked-element id="dialogMarkdown">
            <div class="markdown-html"></div>
            <script type="text/markdown">
                @Html.Raw(Content)
            </script>
        </marked-element>

    </div>

  </template>

  <script>

    Polymer({

      is: 'app-articles',
      properties: {
        subRoute: {
          type: Object,
          value: function() {
            return {};
          },
          observer: '_subRouteChanged'
        },
        articleData: {
          type: Object,
          value: function() {
            return {};
          },
          observer: '_articleDataChanged'
        },
        articleId: {
          type: String,
          value: '',
          reflectToAttribute: true
        },
        article: {
          type: Object,
          value: function() {
            return {};
          }
        },
        articleLoading: {
          type: Boolean,
          value: true
        }
      },
      observers: [
        '_articleDataIdChanged(articleData.id)'
      ],
      _subRouteChanged: function(n,o) {
        //console.log(n);
      },
      _articleDataChanged: function(n,o) {
        //console.log(n);
      },
      _articleDataIdChanged: function(n){
        // console.log(n);
        this.articleId = n;
      },
      _onArticleResult: function(a) {
        console.log(a);
      }

    });

  </script>

</dom-module>
