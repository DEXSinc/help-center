<link rel="import" href="../lib/polymer/polymer.html">
<link rel="import" href="../lib/granite-c3/granite-c3-polymer.1.x.html">

<dom-module id="dashboard-stats-card">

    <template>
        <style>
            :host {
                display: grid;
                grid-template-rows: 1fr auto;
                font-size: 13px;
                -webkit-box-shadow: 1px 1px 1px 0 rgba(0,0,0,.07), 1px 2px 5px 0 rgba(0,0,0,.06);
                box-shadow: 1px 1px 1px 0 rgba(0,0,0,.07), 1px 2px 5px 0 rgba(0,0,0,.06);
                letter-spacing: .1px;
                --stat-card-background-color-0: var(--stat-card-background-color, #42A5F5);
                --stats-card-chart-height-0: var(--stats-card-chart-height, 60px);
            }
            .h4, h4 {
                font-size: 17px;
            }
            .body {
                background-color: var(--stat-card-background-color-0);
                color: #fff;
                padding: 10px;
            }
            .no-margin {
                margin: 0 !important;
            }
            .w300 {
                font-weight: 300;
            }
            .w600 {
                font-weight: 600;
            }
            .white-text {
                color: #FFF;
            }
            .f11 {
                font-size: 11px;
                line-height: 1;
            }
            .f11 span {
                vertical-align: middle;
            }
            .f11 iron-icon {
                --iron-icon-width: 13px;
                --iron-icon-height: 13px;
                width: 13px;
                height: 13px;
            }
            .page-header .actions, .pull-right {
                float: right !important;
            }
            .trending {
                --iron-icon-width: 14px;
                --iron-icon-height: 14px;
                width: 14px;
                height: 14px;
            }
            .card-content {
                background-color: #fff;
                color: #666;
                padding: 15px;
                box-sizing: border-box;
            }
            .row {
                margin-left: -15px;
                margin-right: -15px;
                display: grid;
                grid-template-columns: 1fr 1fr;
            }
            .text-center {
                text-align: center;
            }
            .grey-text, .page-header h1 i {
                color: #9e9e9e;
            }
            .h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
                font-family: inherit;
                font-weight: 400;
                line-height: 1.1;
                color: #444;
            }
            .h3, h3 {
                font-size: 23px;
            }
            :host .card-content p {
                margin: 0;
            }
            .col-lg-1, .col-lg-10, .col-lg-11, .col-lg-12, .col-lg-2, .col-lg-3, .col-lg-4, .col-lg-5, .col-lg-6, .col-lg-7, .col-lg-8, .col-lg-9, .col-md-1, .col-md-10, .col-md-11, .col-md-12, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6, .col-md-7, .col-md-8, .col-md-9, .col-sm-1, .col-sm-10, .col-sm-11, .col-sm-12, .col-sm-2, .col-sm-3, .col-sm-4, .col-sm-5, .col-sm-6, .col-sm-7, .col-sm-8, .col-sm-9, .col-xs-1, .col-xs-10, .col-xs-11, .col-xs-12, .col-xs-2, .col-xs-3, .col-xs-4, .col-xs-5, .col-xs-6, .col-xs-7, .col-xs-8, .col-xs-9 {
                position: relative;
                min-height: 1px;
                padding-left: 15px;
                padding-right: 15px;
            }
            .p-10 {
                padding: 10px;
            }
            .p-t-30 {
                padding-top: 30px;
            }

            .chart {
                background-color: var(--stat-card-background-color-0);
                position: relative;
                height: var(--stats-card-chart-height-0);
                padding: 0;
                overflow: hidden;
            }

            .chart-container {
                position: absolute;
                margin: 0px -5px -8px -5px;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
            }
        </style>
        <!-- 
            icons:trending-up
            icons:trending-flat
            icons:trending-down
            icons:star-border
        -->
        <div class="body">
            <template is="dom-if" if="[[_hasTrend(trend)]]"><div class="pull-right"><iron-icon class="trending" icon="[[_trendIcon]]"></iron-icon>[[trend]]%</div></template>
            <div><h4 class="no-margin w600 white-text">[[title]]</h4></div>
            <div class="f11" style="opacity: 0.8;">
                <iron-icon icon="icons:star-border"></iron-icon>
                <span>[[subtitle]]</span>
            </div>
        </div>
        <div hidden$="[[hideChart]]" class="chart">
            <div class="chart-container">
                <granite-c3 id="graph" data="[[gridData]]" axis="[[gridAxis]]" legend="[[gridLegend]]" tooltip="[[tooltip]]"></granite-c3>
            </div>
        </div>
        <div class="card-content">
            <div class="row" style$="[[_statRowStyle]]">
                <template is="dom-repeat" items="[[stats]]">
                    <div class="col-md-6 text-center" style$="[[_getItemStyle(index)]]">
                        <h3 class="no-margin w300">[[item.value]]</h3>
                        <p class="grey-text w600">[[item.title]]</p>
                    </div>
                </template>
            </div>
        </div>
    </template>

    <script>
        var dummy = {
            data: {
                x: 'x',
                columns: [
                    ['x','2017-09-01','2017-09-02','2017-09-03','2017-09-04','2017-09-05','2017-09-06','2017-09-07','2017-09-08','2017-09-09','2017-09-10','2017-09-11','2017-09-12','2017-09-13','2017-09-14','2017-09-15','2017-09-16','2017-09-17','2017-09-18','2017-09-19','2017-09-20','2017-09-21','2017-09-22','2017-09-23','2017-09-24','2017-09-25','2017-09-26','2017-09-27','2017-09-28','2017-09-29','2017-09-30'],
                    ['sales',1,1,0,0,1,0,1,1,3,0,0,0,3,0,0,1,0,1,0,0,0,0,1,2,1,1,1,0,1,1]
                ],
                types: {
                    sales: 'area-spline'
                },
                colors: {
                    sales: 'rgba(255,255,255,0.50)'
                }
            },
            axis: {
                x: {
                    type: 'timeseries',
                    tick: {
                        format: '%Y-%m-%d'
                    },
                    show: false
                },
                y: {
                    show: false
                }
            },
            legend: {
                show: false
            },
            tooltip: {
                format: {
                    title: function (d) { return new moment(d).format('MMM Do'); },
                    value: function (value, ratio, id) {
                        var formatString = ',';
                        if (id === 'revenue' || id === 'cost' || id === 'cpc') formatString = '$.0f';
                        var format = d3.format(formatString);
                        return format(value);
                    },
                    color: '#000'
                }
            },
            stats: [
                { title: 'Total revenue', value: '$3,750' },
                { title: 'Total sales', value: '116' }
            ]
        };

        Polymer({
            is: 'dashboard-stats-card',
            properties: {
                verbose: {
                    type: Boolean,
                    value: false
                },
                hideChart: {
                    type: Boolean,
                    value: false
                },
                title: {
                    type: String,
                    value: ''
                },
                subtitle: {
                    type: String,
                    value: ''
                },
                trend: {
                    type: Number,
                    value: undefined
                },
                _trendIcon: {
                    type: String,
                    computed: '_getTrendIcon(trend)'
                },
                gridData: {
                    type: Object,
                    notify: true,
                    value: function() {
                        return dummy.data;
                    }
                },
                gridAxis: {
                    type: Object,
                    value: function() {
                        return dummy.axis;
                    }
                },
                gridLegend: {
                    type: Object,
                    value: function() {
                        return dummy.legend;
                    }
                },
                tooltip: {
                    type: Object,
                    value: function() {
                        return dummy.tooltip;
                    }
                },
                stats: {
                    type: Array,
                    value: function() {
                        return dummy.stats;
                    }
                },
                _statRowStyle: {
                    type: String,
                    computed: '_getStatRowStyle(stats)'
                }
            },
            _log: function (msg) {
                if (this.verbose)
                    console.log(msg);
            },
            observers: [

            ],
            ready: function () {
                this._log('address-form ready');
            },
            attached: function () {
                this._log('address-form attached');
            },
            detached: function () {
                this._log('address-form detached');
            },
            refreshGrid: function() {
                this.$.graph._reload();
            },
            _getItemStyle: function(index) {
                return index < this.stats.length-1 ? 'border-right: 1px #F0F0F0 solid;': '';
            },
            _getStatRowStyle: function(stats) {
                return `grid-template-columns: repeat(${stats.length}, 1fr);`;
            },
            _getTrendIcon: function(trend) {
                /*
                icons:trending-up
                icons:trending-flat
                icons:trending-down
                icons:star-border
                */
                if (!trend || trend === 0) return 'trending-flat';
                if (trend > 0) return 'trending-up';
                if (trend < 0) return 'trending-down';
                return 'trending-flat';
            },
            _hasTrend: function(trend) {
                return (trend !== undefined);
            }
        });
    </script>

</dom-module>
